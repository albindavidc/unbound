<%- include('../partials/admin/header') %>

<style>
  .userProfileMain {
    width: 100%;
    height: 30%;
    margin: 0 auto;
    background-color: rgb(0, 0, 0);
  }

  .userProfileH1 {
    width: 100%;
    margin: 10px;
    font-family: "Baloo", cursive;
    color: white;
    font-size: 6vw;
  }

  .breadcrumbCls {
    background-color: rgb(0, 0, 0);
  }
</style>

<section>
  <div class="pb-5 text-center">
    <div class="card userProfileMain rounded">
      <h1 class="userProfileH1">Order Confirm</h1>
    </div>
  </div>
</section>

<section class="container my-5">
  <div class="container table-responsive text-capitalize">
    <table class="table table-striped table-hover">
      <thead>
        <tr class="text-center">
          <th scope="col">#</th>
          <th scope="col">Customer Name</th>
          <th scope="col">Date</th>
          <th scope="col">Product(s)</th>
          <th scope="col">Payment Status</th>
          <th scope="col">Payment Method</th>
          <th scope="col">Amount</th>
          <th scope="col">Delivery Status</th>
          <th scope="col">Action</th>
        </tr>
      </thead>
      <tbody>
        <% if (orders && orders.length > 0) { %> <% orders?.forEach((order,index) => { %>
        <tr class="align-middle text-center">
          <td class="p-4"><%- index+1 %></td>
          <td>
            <%= order.customerId.name %> (<%= order.customerId.email %>)<br /><br />
            Order Id: <%= order._id %>
          </td>

          <td><%- order.createdAt.toLocaleDateString('en-GB') %></td>

          <td>
            <% order.items.forEach(item => { %> <%= item.productId.name %><br />
            <% }) %>
          </td>

          <td>
            <select class="form-select" name="paymentStatus" id="paymentStatus">
              <option value="<%= order.paymentStatus %>"><%= order.paymentStatus %></option>
              <option value="Paid">Paid</option>
              <option value="Refund">Refund</option>
            </select>
          </td>

          <td><%- order.paymentMethod %></td>
          <td>â‚¹<%= order.totalPrice %></td>

          <td>
            <select class="form-select" name="paymentStatus" id="paymentStatus">
               <% 
                const uniqueStatuses = [...new Set(order.items.map(item => item.status))]; 
                uniqueStatuses.forEach(status => { 
                %>
                <option value="<%= status %>" <%= order.paymentStatus === status ? 'selected' : '' %>><%= status %></option>
                <% }) %>

              <option value="Shipped">Shipped</option>
              <option value="Delivered">Delivered</option>
              <option value="Cancelled">Cancelled</option>
            </select>
          </td>

          <td>
            <div class="d-flex justify-content-center p-4">
              <% if (order.status) { %>
              <a href="/admin/orders/update/<%- order._id %>%>">
                <button type="button" class="btn btn-sm btn-dark">Update</button>
              </a>

              <% } %>
            </div>
          </td>
        </tr>
        <% }) %> <% } else { %>
        <td colspan="8" class="text-danger">No Orders Available</td>
        <% } %>
      </tbody>
    </table>
  </div>

  <%- include('../partials/admin/footer') %>
</section>

<script>

</script>
