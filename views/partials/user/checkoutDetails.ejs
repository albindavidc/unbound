<section>
  <% if (reload == true) { %>
  <script>
    window.location.reload();
  </script>
  <% } %>
  <div class="container mb-7">
    <div class="row g-5">
      <!-- Checkout Pricing Panel -->
      <div class="col-md-5 col-lg-12 order-md-last" id="orderDetailsReload">
        <h4 class="block-header bg-secondary-light d-flex justify-content-between align-items-center mb-3">
          <span class="">Your cart</span>
          <span class="badge bg-secondary rounded-pill"><%- cartCount %></span>
        </h4>
        <ul class="list-group mb-3 text-capitalize">
          <% cartList.forEach(item => { %>
          <li class="list-group-item d-flex justify-content-between lh-sm">
            <div class="fs-5">
              <h6 class="my-0"><%- item.productId.name %></h6>
              <small class="text-body-secondary">Size: <%- item.sizeId.value %></small> <br />
              <small class="text-body-secondary">Color: <%- item.colorId.name %></small> <br />
              <small class="text-body-secondary">Quantity: <%- item.quantity %></small>
            </div>
            <div class="d-flex flex-column align-items-end lead fs-6">
              <span class="fw-semibold text-body-secondary">Price per item: <span class="text-muted">₹<%- item.price %></span></span>
              <span class="text-body-secondary fw-semibold">Total: ₹<%- item.itemTotal %></span>
            </div>
          </li>
          <% }) %>
          <li class="list-group-item d-flex justify-content-between">
            <span>Grand Total (INR)</span>
            <strong>₹<span id="grandTotal"><%- payable %></span></strong>
          </li>

          <!-- Applied Coupon Section -->
          <li class="list-group-item d-flex justify-content-between bg-body-tertiary d-none" id="appliedCoupon">
            <div class="text-success">
              <h6 class="my-0">Coupon code</h6>
              <small class="text-uppercase" id="coupon"></small>
            </div>
            <span class="text-success" id="discountAmount">−₹</span>
          </li>

          <% if (typeof userCart.coupon !== 'undefined' && userCart.coupon) { %>
          <li class="list-group-item d-flex justify-content-between bg-body-tertiary" id="appliedCoupon">
            <div class="text-success">
              <h6 class="my-0">Coupon code</h6>
              <small class="text-uppercase" id="coupon"><%- userCart.coupon.code %></small>
            </div>
            <span class="text-success" id="discountAmount">−₹<%- userCart.couponDiscount.toFixed(2) %></span>
          </li>
          <% } %>

          <!-- Apply Coupon Form -->
          <form class="card p-2" id="applyCoupon">
            <label class="form-label text-dark">Coupon</label>
            <fieldset>
              <div class="input-group">
                <!-- Remove Coupon Button -->
                <button
                  onclick="removeCoupon()"
                  type="button"
                  class="btn btn-outline-warning"
                >
                  Remove Coupon
                </button>
              </div>
            </fieldset>
          </form>

          <!-- Available Coupons Accordion -->
          <div id="couponsAccordion" class="text-capitalize accordion mt-4">
            <h6 class="mb-3 fs-5">Available Coupons</h6>

            <% if (typeof coupons !== 'undefined' && coupons.length > 0) { %> <% coupons.forEach(function(coupon, index) { %>
            <div class="accordion-item">
              <h2 class="accordion-header" id="heading<%= index %>">
                <button
                  class="accordion-button collapsed text-uppercase text-success"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#collapse<%= index %>"
                  aria-expanded="false"
                  aria-controls="collapse<%= index %>"
                >
                  <%= coupon.code %>
                </button>
              </h2>
              <div
                id="collapse<%= index %>"
                class="accordion-collapse collapse"
                aria-labelledby="heading<%= index %>"
                data-bs-parent="#couponsAccordion"
              >
                <div class="accordion-body">
                  <!-- Coupon Card -->
                  <div class="coupon-card">
                    <h4 class="coupon-title"><%= coupon.Description %></h4>
                    <p>Discount: <%= coupon.rateOfDiscount + '%' %></p>
                    <p>Min Order Amount: <%= coupon.minPurchaseAmount %></p>
                    <p>Expiry Date: <%= coupon.expiringDate.toDateString() %></p>
                    <button type="button" onclick="copyCode('<%= coupon.code %>')" class="btn btn-primary btn-sm">Copy Code</button>
                  </div>
                </div>
              </div>
            </div>
            <% }); %> <% } else { %>
            <p class="lead text-warning">No Coupons Available</p>
            <% } %>
          </div>

          <li class="list-group-item d-flex justify-content-between">
            <span>Grand Total (INR)</span>
            <strong>₹<span id="grandTotal"><%- totalPrice %></span></strong>
          </li>
        </ul>
      </div>
    </div>
  </div>
</section>
